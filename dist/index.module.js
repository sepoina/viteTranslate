import e from"path";import n from"fnv1a";import r from"fs";function a(e,n){var r,a;if(null!=e&&null!=(r=e.node)&&r.value&&/_%_(.*?)_%_/.test(e.node.value)){var t=null==(a=/_%_(.*?)_%_/.exec(e.node.value))?void 0:a[1];if(t){var i=o(t,n);e.node.value=l(e.node.value,i,t),e.node.extra.rawValue&&(e.node.extra.rawValue=l(e.node.extra.rawValue,i,t)),e.node.extra.raw&&(e.node.extra.raw=l(e.node.extra.raw,i,t))}}}function l(e,n,r){return e.replace(/_%_(.*?)_%_/,"_<_"+n+"_/_"+r+"_>_")}function o(r,a){var l=e.parse(a.filename).name+"_"+n(r).toString(36);return globalThis.TranslateService.baseLng[l]=r,l}var t=function(e){var n=e.types;return{visitor:{StringLiteral:a,JSXText:a,TemplateElement:a,JSXOpeningElement:function(e,r){if("Translate"===e.node.name.name){var a=e.node.attributes.find(function(e){var n;return"data-translate"===(null==e||null==(n=e.name)?void 0:n.name)});if(!a&&!e.node.attributes.find(function(e){return"c"===(null==e?void 0:e.name.name)})){var l,t,i,u,s=e.node.attributes.find(function(e){var n;return"t"===(null==e||null==(n=e.name)?void 0:n.name)}),d=s?!!(u=e.node.attributes.find(function(e){var n;return"t"===(null==e||null==(n=e.name)?void 0:n.name)}))&&("StringLiteral"===(null==u||null==(l=u.value)?void 0:l.type)?u.value.value:"JSXExpressionContainer"===(null==u||null==(t=u.value)?void 0:t.type)&&"StringLiteral"===(null==u||null==(i=u.value)||null==(i=i.expression)?void 0:i.type)&&u.value.expression.value):function(e){var n;if(1===(null==e||null==(n=e.container)||null==(n=n.children)?void 0:n.length)){var r,a=e.container.children[0];return"JSXText"===a.type?a.value:!("JSXExpressionContainer"!==a.type||null==a||null==(r=a.expression)||!r.value)&&a.expression.value}return!1}(e);if(!1===d)throw"Errore, Translate deve contenere solo stringhe";var c=o(d,r),v=n.jSXAttribute(n.jSXIdentifier("data-translate"),n.stringLiteral(c));e.node.attributes.push(v)}}}}}};function i(e){return{name:"onRollupTranslate",buildStart:{sequential:!0,order:"pre",handler:function(){globalThis.TranslateService=e,globalThis.TranslateService.baseLng={__lngVersion__:Date.now()},console.log("Preparo il servizio traduzioni.")}},buildEnd:{sequential:!0,order:"post",handler:function(){!function(){var e=globalThis.TranslateService.file,n=globalThis.TranslateService.dist;console.log("TRANSLATE ---------------------------------------------"),console.log("Carico traduzione base.");try{r.readFile(e,"utf8",function(a,l){var o={newest:!0,changed:!0},t=null;a?(console.log("Non esiste ancora il file "+e+", tento di crearlo"),t=globalThis.TranslateService.baseLng):o=function(e,n){var r={changed:!1,deleted:0,added:0};for(var a in e)a in n||(delete e[a],r.changed=!0,r.deleted+=1);for(var l in n)l in e||(e[l]=n[l],r.changed=!0,r.added+=1);return r.changed&&(e.__lngVersion__=n.__lngVersion__),r}(t=JSON.parse(l),globalThis.TranslateService.baseLng),o.changed?(console.log("Update avvenuto: "+(o.newest?"Nuovo file,":"("+o.added+" agginte, "+o.deleted+" rimosse)")+" salvo."),r.writeFile(e,JSON.stringify(t,null,2),"utf8",function(a){a?console.error("Errore durante la scrittura su "+e,a):(console.log("Dati scritti con successo su "+e),r.copyFile(e,n,function(e){e||console.log("Copiato con successo su "+n),console.log("END TRANSLATE ---------------------------------------------")}))})):(console.log("Nessun cambiamento."),console.log("END TRANSLATE ---------------------------------------------"))})}catch(n){return void console.error("Errore l'elaborazione di "+e+", cancellalo",n)}}()}}}}export{t as babelTranslate,i as rollupTranslate};
//# sourceMappingURL=index.module.js.map
